@using MvcPaging;
@using AgvWarehouseWeb.Helpers;

@model IPagedList<AGVCenterLib.Data.StockMovement>


<div class="row" style="margin:0;">
    <div class="col-md-12">
        <form action="/StockMovement/Search" method="get">
            <div class="col-lg-2 col-md-2 col-sm-6 col-xs-12">
                <div class="marco-igroup-primary">
                    <span>KSK 号</span>
                    <input type="text" name="UniqItemNr" id="UniqItemNr" placeholder="KSK 号" value="@ViewBag.Query.UniqItemNr" />
                </div>
            </div>


            <div class="col-lg-2 col-md-2 col-sm-6 col-xs-12">
                <div class="marco-igroup-primary">
                    <span>库位号</span>
                    <input type="text" name="PositionNr" id="PositionNr" placeholder="库位号" value="@ViewBag.Query.PositionNr" />

                </div>
            </div>
            <div class="col-lg-2 col-md-2 col-sm-6 col-xs-12">
                <div class="marco-igroup-primary">
                    <span>记录类型</span>
                    @SelectHelper.StockMovementTypeDropdownList(this.Html,(int?)ViewBag.Query.StockMovementType, "StockMovementType")
                </div>
            </div>
            <button type="submit" class="marco-btn-success" style="margin-left:0;">
                <i class="glyphicon glyphicon-search"></i>
                搜索
            </button>

            @Html.Partial("Search/_CreatedAtSearchPartial")

        </form>

        <div>
            @Html.ActionLink("导出库存记录报表", "Export", new{
           PositionNr = ViewBag.Query.PositionNr,
           UniqItemNr = ViewBag.Query.UniqItemNr,
           StockMovementType = ViewBag.Query.StockMovementType,
           CreatedAtStart = ViewBag.Query.CreatedAtStart,
           CreatedAtEnd = ViewBag.Query.CreatedAtEnd
       }, new
       {
           @style = "width:150px; margin-top:10px;margin-left:30px;",
           @class = "btn btn-success",
           @title = "先搜索，根据搜索条件导出报表",
           data_toggle = "tooltip",
           data_placement = "bottom"
       })
          </div>

                </div>
            </div>

            <table class="table">
                <tr>
                    <th>&nbsp;</th>
                    <th>
                        KSK号
                    </th>
                    <th>
                        来源库位
                    </th>
                    <th>
                        目的库位
                    </th>
                    <th>
                        记录类型
                    </th>
                    <th>
                        操作者
                    </th>
                    <th>
                        操作时间
                    </th>
                    <th>
                        创建时间
                    </th>
                    @*<th></th>*@
            </tr>
            @if (Model != null)
            {
                int i = 0;
                foreach (var item in Model)
                {
                    <tr>
                        <td>@(i += 1)</td>
                        <td>
                            @Html.DisplayFor(modelItem => item.UniqItemNr)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.SourcePosition)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.AimedPosition)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.TypeStr)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Operator)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Time)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.CreatedAt)
                        </td>
                        @*<td>
                            @Html.ActionLink("Edit", "Edit", new { id=item.Id }) |
                            @Html.ActionLink("Details", "Details", new { id=item.Id }) |
                            @Html.ActionLink("Delete", "Delete", new { id=item.Id })
                        </td>*@
                    </tr>
                }
            }

            </table>



            <div class="col-sm-12" style="text-align:center;">
                <div class="clearfix pagination">
                    <div class="pagination-inner">
                        @if (Model != null)
            {
                if (ViewBag.Query != null)
                {
                    var html = Html.Pager(Model.PageSize, Model.PageNumber, Model.TotalItemCount)
                        .Options(o => o.AddRouteValue("PositionNr", ViewBag.Query.PositionNr))
                        .Options(o => o.AddRouteValue("UniqItemNr", ViewBag.Query.UniqItemNr))
                        .Options(o => o.AddRouteValue("StockMovementType", ViewBag.Query.StockMovementType))
                          .Options(o => o.AddRouteValue("CreatedAtStart", ViewBag.Query.CreatedAtStart))
                             .Options(o => o.AddRouteValue("CreatedAtEnd", ViewBag.Query.CreatedAtEnd));
                                @html
                            }
                            else
                            {
                                @Html.Pager(Model.PageSize, Model.PageNumber, Model.TotalItemCount)
                            }


                            <br />
                            <span>总数： @Model.TotalItemCount</span>
                            <br />
                        }
                    </div>
                </div>
            </div>
